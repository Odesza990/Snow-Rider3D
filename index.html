<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Snow Rider 3D - Thrilling Skiing Adventure Game</title>
    <meta name="description" content="Immerse yourself in Snow Rider 3D, a thrilling skiing adventure game set in breathtaking mountain landscapes. Ride your sleigh down snowy slopes, dodge obstacles, and collect gifts for an exhilarating experience.">
    <meta name="theme-color" content="#007ACC">
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Your Name">
    <meta name="keywords" content="Snow Rider 3D, skiing game, winter sports, snowboarding, ski game, mountain landscapes, skiing adventure, snowboarding adventure, snowy mountain, sleigh ride, winter game">
    <script>
        // === 超早期强制防护：在任何脚本加载前拦截 ===
        console.log("🛡️ 部署超早期防护系统...");

        // 1. 完全禁用 window.open - 最强硬的拦截
        window.open = function() {
            console.warn("🚫 已强制阻止 window.open 调用:", arguments[0] || "unknown");
            console.trace("调用堆栈:");
            return {
                focus: function(){},
                blur: function(){},
                close: function(){},
                closed: false,
                location: { href: "" },
                document: { write: function(){} }
            }; // 返回假窗口对象避免脚本报错
        };

        // 2. 冻结 window.open 防止被重新赋值
        try {
            Object.defineProperty(window, 'open', {
                value: window.open,
                writable: false,
                configurable: false
            });
            console.log("✅ window.open 已被永久锁定");
        } catch(e) {
            console.warn("⚠️ 无法锁定 window.open:", e.message);
        }

        // 3. 拦截所有可能的跳转方法
        const blockRedirect = function(method, url) {
            console.warn("🚫 已阻止", method, "跳转到:", url);
            return false;
        };

        // 重写 location 方法
        const originalLocation = window.location;
        window.location.replace = function(url) { return blockRedirect("location.replace", url); };
        window.location.assign = function(url) { return blockRedirect("location.assign", url); };

        // 4. 监听所有点击事件并强制阻止跳转
        document.addEventListener('click', function(event) {
            console.log("🔍 拦截点击:", event.target.tagName);

            // 强制阻止所有可疑点击
            setTimeout(() => {
                const currentUrl = window.location.href;
                if (currentUrl.includes('cmug') || currentUrl.includes('gitlab.io') ||
                    currentUrl !== originalLocation.href) {
                    console.error("🚨 检测到恶意跳转，强制阻止！");
                    window.stop();
                    window.history.back();
                }
            }, 1);
        }, true);

        // 5. 每50ms监控URL变化
        let lastHref = window.location.href;
        const urlMonitor = setInterval(() => {
            if (window.location.href !== lastHref) {
                if (window.location.href.includes('cmug') || window.location.href.includes('gitlab.io')) {
                    console.error("🚨 URL监控：检测到恶意跳转，立即阻止！");
                    window.stop();
                    window.history.back();
                    // 强制恢复原URL
                    try {
                        originalLocation.replace(lastHref);
                    } catch(e) {
                        console.warn("无法恢复原URL");
                    }
                } else {
                    lastHref = window.location.href;
                }
            }
        }, 50);

        // 6. 专门拦截发现的广告SDK
        const blockAdSDK = function(sdkName, method) {
            console.warn("🚫 已阻止广告SDK调用:", sdkName, method);
            return false;
        };

        // 拦截 GameDistribution SDK
        window.gdsdk = window.gdsdk || {};
        window.gdsdk.showAd = function() { return blockAdSDK("GameDistribution", "showAd"); };

        // 拦截 ubg235 commercial 系统
        window.ubg235 = window.ubg235 || {};
        window.ubg235.commercial = window.ubg235.commercial || {};
        window.ubg235.commercial.ADS = function() { return blockAdSDK("ubg235", "commercial.ADS"); };

        // 7. 拦截所有可能的广告相关全局对象
        const adBlacklist = ['gdsdk', 'ubg235', 'commercial', 'showAd', 'openGame'];
        adBlacklist.forEach(adObj => {
            if (window[adObj] && typeof window[adObj] === 'object') {
                for (let method in window[adObj]) {
                    if (typeof window[adObj][method] === 'function') {
                        window[adObj][method] = function() {
                            return blockAdSDK(adObj, method);
                        };
                    }
                }
            }
        });

        console.log("✅ 超早期防护系统已激活，所有跳转将被强制阻止！");
    </script>
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
        // === 正常游戏初始化 ===
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/SnowRider3D-gd-1.json", {onProgress: UnityProgress,Module:{onRuntimeInitialized: function() {UnityProgress(gameInstance, "complete")}}});
    </script>
</head>
<body style="overflow:hidden;padding:0px;margin:0px;">
    <div class="webgl-content">
        <div id="gameContainer" style="width: 960px; height: 600px; margin: auto"></div>
    </div>
</body>
</html>

