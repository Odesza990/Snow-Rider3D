<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Snow Rider 3D - Thrilling Skiing Adventure Game</title>
    <meta name="description" content="Immerse yourself in Snow Rider 3D, a thrilling skiing adventure game set in breathtaking mountain landscapes. Ride your sleigh down snowy slopes, dodge obstacles, and collect gifts for an exhilarating experience.">
    <meta name="theme-color" content="#007ACC">
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Your Name">
    <meta name="keywords" content="Snow Rider 3D, skiing game, winter sports, snowboarding, ski game, mountain landscapes, skiing adventure, snowboarding adventure, snowy mountain, sleigh ride, winter game">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
        // === å…¨å±€é˜²æŠ¤ä»£ç ï¼šé˜»æ­¢æ‰€æœ‰æ¶æ„è·³è½¬ ===
        console.log("ğŸ›¡ï¸ æ­£åœ¨åŠ è½½å…¨å±€è·³è½¬é˜²æŠ¤...");

        // 1. ç¦ç”¨ window.open - é˜»æ­¢æ‰“å¼€æ–°çª—å£/æ ‡ç­¾é¡µ
        const originalWindowOpen = window.open;
        window.open = function(url, target, features) {
            console.warn("ğŸš« å·²é˜»æ­¢ window.open è·³è½¬åˆ°:", url);
            return null;
        };

        // 2. æ‹¦æˆª location å¯¹è±¡çš„è·³è½¬æ–¹æ³•ï¼ˆä½¿ç”¨æ›¿æ¢æ–¹å¼ï¼‰
        const originalReplace = window.location.replace;
        const originalAssign = window.location.assign;

        window.location.replace = function(url) {
            console.warn("ğŸš« å·²é˜»æ­¢ location.replace è·³è½¬åˆ°:", url);
            return false;
        };

        window.location.assign = function(url) {
            console.warn("ğŸš« å·²é˜»æ­¢ location.assign è·³è½¬åˆ°:", url);
            return false;
        };

        // æ‹¦æˆªç›´æ¥è®¾ç½® location çš„å°è¯•
        let originalLocationSetter = window.location;
        try {
            Object.defineProperty(window, 'location', {
                get: function() { return originalLocationSetter; },
                set: function(url) {
                    console.warn("ğŸš« å·²é˜»æ­¢é€šè¿‡ window.location è·³è½¬åˆ°:", url);
                    return false;
                }
            });
        } catch(e) {
            console.log("âš ï¸ æ— æ³•æ‹¦æˆª window.location ç›´æ¥èµ‹å€¼ï¼Œä½¿ç”¨å…¶ä»–æ–¹å¼é˜²æŠ¤");
        }

        // 3. å¼ºåŠ›å…¨å±€ç‚¹å‡»äº‹ä»¶æ‹¦æˆª
        document.addEventListener('click', function(event) {
            console.log("ğŸ” æ£€æµ‹åˆ°ç‚¹å‡»äº‹ä»¶ï¼Œç›®æ ‡:", event.target);

            // é˜»æ­¢æ‰€æœ‰å¯èƒ½çš„æ¶æ„ç‚¹å‡»
            const target = event.target;

            // æ£€æŸ¥ onclick å±æ€§
            if (target && (target.onclick || target.getAttribute('onclick'))) {
                const onclickCode = target.onclick ? target.onclick.toString() : target.getAttribute('onclick');
                if (onclickCode && (onclickCode.includes('window.open') || onclickCode.includes('location') || onclickCode.includes('cmug') || onclickCode.includes('gitlab'))) {
                    console.warn("ğŸš« å·²é˜»æ­¢æ¶æ„ onclick äº‹ä»¶:", onclickCode);
                    event.preventDefault();
                    event.stopImmediatePropagation();
                    return false;
                }
            }

            // æ£€æŸ¥é“¾æ¥æ ‡ç­¾
            let currentElement = target;
            while (currentElement && currentElement !== document) {
                if (currentElement.tagName === 'A' && currentElement.href) {
                    if (currentElement.href.includes('cmug') || currentElement.href.includes('gitlab.io')) {
                        console.warn("ğŸš« å·²é˜»æ­¢æ¶æ„é“¾æ¥ç‚¹å‡»:", currentElement.href);
                        event.preventDefault();
                        event.stopImmediatePropagation();
                        return false;
                    }
                }
                currentElement = currentElement.parentElement;
            }

            // é˜²å¾¡æ€§æªæ–½ï¼šå¦‚æœæ£€æµ‹åˆ°ä»»ä½•å¯ç–‘æ´»åŠ¨å°±é˜»æ­¢
            setTimeout(() => {
                if (window.location.href.includes('cmug') || window.location.href.includes('gitlab.io')) {
                    console.error("ğŸš¨ æ£€æµ‹åˆ°é¡µé¢è¢«æ¶æ„è·³è½¬ï¼Œå°è¯•é˜»æ­¢...");
                    history.back();
                }
            }, 10);

        }, true); // ä½¿ç”¨æ•è·é˜¶æ®µç¡®ä¿ä¼˜å…ˆæ‰§è¡Œ

        // 4. é¢å¤–çš„å…¨å±€é˜²æŠ¤ï¼šç›‘æ§ URL å˜åŒ–
        let lastUrl = window.location.href;
        setInterval(() => {
            if (window.location.href !== lastUrl) {
                if (window.location.href.includes('cmug') || window.location.href.includes('gitlab.io')) {
                    console.error("ğŸš¨ æ£€æµ‹åˆ°æ¶æ„è·³è½¬ï¼Œç«‹å³é˜»æ­¢!");
                    window.stop(); // åœæ­¢é¡µé¢åŠ è½½
                    history.back(); // è¿”å›ä¸Šä¸€é¡µ
                } else {
                    lastUrl = window.location.href;
                }
            }
        }, 100); // æ¯100msæ£€æŸ¥ä¸€æ¬¡

        // 5. è¦†ç›– document.createElement é˜²æ­¢åŠ¨æ€åˆ›å»ºæ¶æ„å…ƒç´ 
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(document, tagName);
            if (tagName.toLowerCase() === 'a') {
                // æ‹¦æˆªåŠ¨æ€åˆ›å»ºçš„é“¾æ¥ç‚¹å‡»
                element.addEventListener('click', function(e) {
                    if (this.href && (this.href.includes('cmug') || this.href.includes('gitlab.io'))) {
                        console.warn("ğŸš« å·²é˜»æ­¢æ¶æ„é“¾æ¥ç‚¹å‡»:", this.href);
                        e.preventDefault();
                        return false;
                    }
                });
            }
            return element;
        };

        // 6. æ‹¦æˆª XMLHttpRequest å’Œ fetch è¯·æ±‚ä¸­çš„å¯ç–‘è¯·æ±‚
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            if (typeof url === 'string' && (url.includes('cmug') || url.includes('gitlab.io'))) {
                console.warn("ğŸš« å·²é˜»æ­¢å¯ç–‘ç½‘ç»œè¯·æ±‚:", url);
                return Promise.reject(new Error('Blocked malicious request'));
            }
            return originalFetch.apply(this, arguments);
        };

        // 7. å®šæœŸæ¸…ç†å¯èƒ½çš„æ¶æ„è„šæœ¬
        setInterval(function() {
            const scripts = document.querySelectorAll('script[src*="cmug"], script[src*="gitlab.io"]');
            scripts.forEach(script => {
                console.warn("ğŸš« å‘ç°å¹¶ç§»é™¤æ¶æ„è„šæœ¬:", script.src);
                script.remove();
            });
        }, 1000);

        console.log("âœ… å…¨å±€è·³è½¬é˜²æŠ¤å·²æ¿€æ´»ï¼æ‰€æœ‰æ¶æ„è·³è½¬å°†è¢«é˜»æ­¢ã€‚");

        // === æ­£å¸¸æ¸¸æˆåˆå§‹åŒ– ===
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/SnowRider3D-gd-1.json", {onProgress: UnityProgress,Module:{onRuntimeInitialized: function() {UnityProgress(gameInstance, "complete")}}});
    </script>
</head>
<body style="overflow:hidden;padding:0px;margin:0px;">
    <div class="webgl-content">
        <div id="gameContainer" style="width: 960px; height: 600px; margin: auto"></div>
    </div>
</body>
</html>

