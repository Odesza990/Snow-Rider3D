<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Snow Rider 3D - Thrilling Skiing Adventure Game</title>
    <meta name="description" content="Immerse yourself in Snow Rider 3D, a thrilling skiing adventure game set in breathtaking mountain landscapes. Ride your sleigh down snowy slopes, dodge obstacles, and collect gifts for an exhilarating experience.">
    <meta name="theme-color" content="#007ACC">
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Your Name">
    <meta name="keywords" content="Snow Rider 3D, skiing game, winter sports, snowboarding, ski game, mountain landscapes, skiing adventure, snowboarding adventure, snowy mountain, sleigh ride, winter game">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
        // === 全局防护代码：阻止所有恶意跳转 ===
        console.log("🛡️ 正在加载全局跳转防护...");

        // 1. 禁用 window.open - 阻止打开新窗口/标签页
        const originalWindowOpen = window.open;
        window.open = function(url, target, features) {
            console.warn("🚫 已阻止 window.open 跳转到:", url);
            return null;
        };

        // 2. 拦截 location 对象的所有跳转方法
        let isNavigating = false;
        const originalLocation = window.location;

        // 禁用 location.href 设置
        Object.defineProperty(window.location, 'href', {
            get: function() { return originalLocation.href; },
            set: function(url) {
                console.warn("🚫 已阻止 location.href 跳转到:", url);
                return false;
            }
        });

        // 禁用其他 location 方法
        window.location.replace = function(url) {
            console.warn("🚫 已阻止 location.replace 跳转到:", url);
        };

        window.location.assign = function(url) {
            console.warn("🚫 已阻止 location.assign 跳转到:", url);
        };

        // 3. 监听并阻止全局点击事件中的恶意跳转
        document.addEventListener('click', function(event) {
            // 检查是否有恶意跳转行为
            const target = event.target;
            if (target && (target.onclick || target.getAttribute('onclick'))) {
                const onclickCode = target.onclick ? target.onclick.toString() : target.getAttribute('onclick');
                if (onclickCode && (onclickCode.includes('window.open') || onclickCode.includes('location'))) {
                    console.warn("🚫 已阻止恶意点击事件:", onclickCode);
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
            }
        }, true); // 使用捕获阶段确保优先执行

        // 4. 覆盖 document.createElement 防止动态创建恶意元素
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(document, tagName);
            if (tagName.toLowerCase() === 'a') {
                // 拦截动态创建的链接点击
                element.addEventListener('click', function(e) {
                    if (this.href && (this.href.includes('cmug') || this.href.includes('gitlab.io'))) {
                        console.warn("🚫 已阻止恶意链接点击:", this.href);
                        e.preventDefault();
                        return false;
                    }
                });
            }
            return element;
        };

        // 5. 拦截 XMLHttpRequest 和 fetch 请求中的可疑请求
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            if (typeof url === 'string' && (url.includes('cmug') || url.includes('gitlab.io'))) {
                console.warn("🚫 已阻止可疑网络请求:", url);
                return Promise.reject(new Error('Blocked malicious request'));
            }
            return originalFetch.apply(this, arguments);
        };

        // 6. 定期清理可能的恶意脚本
        setInterval(function() {
            const scripts = document.querySelectorAll('script[src*="cmug"], script[src*="gitlab.io"]');
            scripts.forEach(script => {
                console.warn("🚫 发现并移除恶意脚本:", script.src);
                script.remove();
            });
        }, 1000);

        console.log("✅ 全局跳转防护已激活！所有恶意跳转将被阻止。");

        // === 正常游戏初始化 ===
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/SnowRider3D-gd-1.json", {onProgress: UnityProgress,Module:{onRuntimeInitialized: function() {UnityProgress(gameInstance, "complete")}}});
    </script>
</head>
<body style="overflow:hidden;padding:0px;margin:0px;">
    <div class="webgl-content">
        <div id="gameContainer" style="width: 960px; height: 600px; margin: auto"></div>
    </div>
</body>
</html>

